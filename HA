- platform: trend
  sensors:
    shower_detected:
      friendly_name: Bathroom Shower Detected
      device_class: occupancy
      max_samples: 10
      entity_id: sensor.bathroom_humidity
      sample_duration: 60
      min_gradient: 0.15
      
      
      
type: 'custom:auto-entities'
card:
  type: entities
  title: Low Batteries
sort:
  method: state
filter:
  template: |
    {% for entity in states.sensor -%}
     {%- if ('battery' in entity.entity_id) and (state_attr(entity.entity_id, 'battery') != None) and (state_attr(entity.entity_id, "battery") | float <= states("input_number.low_battery_threshold") | float)-%}
      {{entity.entity_id}}
     {% endif %}
    {%- endfor %}



- platform: sql
  db_url: !secret db_url
  queries:
    - name: DB states
      query: 'SELECT round(count(*)/1024,1) AS cnt FROM states;'
      column: "cnt"
      unit_of_measurement: k
      
      
https://community.home-assistant.io/t/counting-open-doors-motion-sensors-solved-by-ranting-at-myself/47377/5      
- platform: template
    sensors:
      door_count:
        value_template: >-
           {{ states | selectattr('entity_id','in',state_attr('group.door_sensors','entity_id')) | selectattr('state','eq','on') | list | count | int}}
      window_count:
        value_template: >-
           {{ states | selectattr('entity_id','in',state_attr('group.window_sensors','entity_id')) | selectattr('state','eq','on') | list | count | int}}
           
           
           
 - platform: template
  sensors:
    door_count:
      value_template: >-
        {{ states.binary_sensor | selectattr('state', 'eq', 'on') | selectattr('attributes.device_class', 'eq', 'door') | list | count }}
    window_count:
      value_template: >-
        {{ states.binary_sensor | selectattr('state', 'eq', 'on') | selectattr('attributes.device_class', 'eq', 'window') | list | count }}
    motion_count:
      value_template: >-
        {{ states.binary_sensor | selectattr('state', 'eq', 'on') | selectattr('attributes.device_class', 'eq', 'motion') | list | count }}
        
        
        
# Doors and Windows Open

- platform: template
  sensors:
    door_count:
      value_template: >
        "{{ expand('group.doors_windows')|selectattr('state','eq','on')|list|count }}" 
